# UltraZend Production Docker Compose
version: '3.8'

services:
  ultrazend-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ultrazend-production
    restart: unless-stopped
    
    ports:
      - "80:80"        # Frontend nginx
      - "443:443"      # HTTPS
      - "3001:3001"    # Backend API
      - "25:25"        # SMTP Server
    
    volumes:
      - ultrazend-data:/var/www/ultrazend/data
      - ultrazend-logs:/var/www/ultrazend/logs
      - ultrazend-backups:/var/www/ultrazend/backup
      
    environment:
      - NODE_ENV=production
      - TZ=America/Sao_Paulo
      
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
      
    networks:
      - ultrazend-network

  # MailHog for email testing (remove in production)
  mailhog:
    image: mailhog/mailhog:latest
    container_name: ultrazend-mailhog
    restart: unless-stopped
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI
    networks:
      - ultrazend-network

volumes:
  ultrazend-data:
    driver: local
  ultrazend-logs:
    driver: local
  ultrazend-backups:
    driver: local

networks:
  ultrazend-network:
    driver: bridge